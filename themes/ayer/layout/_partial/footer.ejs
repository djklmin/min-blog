<footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        <% if (theme.since && !isNaN(theme.since) && theme.since < date(new Date(), 'YYYY')) { %><%- theme.since%>-<% } %><%= date(new Date(), 'YYYY') %>
        <i class="ri-heart-fill heart_icon"></i> <%= config.author || config.title %>
      </li>
    </ul>
    <ul>
      <li>
        <% if (theme.pageFooter){ %>
        <% var hexoLink = '<a href="https://hexo.io" target="_blank">Hexo</a>'; %>
        <% var themeLink = '<a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>'; %>
        <%- __('powered_by', hexoLink) %>
        <span class="division">|</span>
        <%- __('theme', themeLink) %>
        <% } %>
      </li>
    </ul>
    <ul>
      <li>
        <% if (theme.busuanzi && theme.busuanzi.enable){ %>
        <%# "ä¸è’œå­ç»Ÿè®¡" %>
        <%- partial('post/busuanzi') %>
        <% } %>
      </li>
    </ul>
    <ul>
      <% if (theme.icp&&theme.icp.enable){ %>
        <li>
          <a href="<%= theme.icp.url %>" target="_black" rel="nofollow"><%= theme.icp.text %></a>
        </li>
        <% } %>
    </ul>
    <ul>
      <% if (theme.gongan&&theme.gongan.enable){ %>
      <li>
          <img src="<%= theme.gongan.img %>"></img>
          <a href="<%= theme.gongan.url %>" target="_black" rel="nofollow"><%= theme.gongan.text %></a>
      </li>
        <% } %>
    </ul>
    <ul>
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        <% if (theme.cnzz&&theme.cnzz.enable){ %>
        <script type="text/javascript" src='<%= theme.cnzz.url%>'></script>
        <% } %>
      </li>
    </ul>
  </div>
</footer>

<!-- Live2D çœ‹æ¿å¨˜ä»£ç å¼€å§‹ -->
<!-- ä½¿ç”¨æœ¬åœ°è·¯å¾„åŠ è½½ Live2D èµ„æº -->
<link rel="stylesheet" href="/js/waifu.css"/>
<script src="/js/waifu-tips.js"></script>
<script src="/js/live2d.js"></script>

<script>
// åˆå§‹åŒ–çœ‹æ¿å¨˜
function initWidget() {
    console.log('ğŸ”„ å¼€å§‹åˆå§‹åŒ–çœ‹æ¿å¨˜...');
    
    // é…ç½®è®¾ç½®
    window.live2d_settings = {
        model: { 
            scale: 1,
            // ä½¿ç”¨æœ¬åœ°è·¯å¾„æŒ‡å‘ LSS æ¨¡å‹
            jsonPath: '/live2d_models/lss/LSS.model3.json',
        },
        display: {
            position: 'right',
            width: 220,
            height: 400,
            hOffset: 0,
            vOffset: -20,
            superSample: 2,
        },
        mobile: { 
            show: true,        // åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤º
            scale: 0.6,        // ç§»åŠ¨è®¾å¤‡ä¸Šçš„ç¼©æ”¾æ¯”ä¾‹
            motion: true       // ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¯å¦å¯ç”¨è§¦æ‘¸åŠ¨ä½œ
        },
        react: { 
            opacity: 0.9, 
            opacityDefault: 0.7,
            opacityOnHover: 0.9
        },
        dialog: {
            enable: true,
            script: {
                // ç‚¹å‡»èº«ä½“æ—¶çš„å¯¹è¯
                click: [
                    "å˜¿ï¼æ¬¢è¿æ¥åˆ°æˆ‘çš„å°çªï¼âœ§(â‰– â—¡ â‰–âœ¿)",
                    "è¿™æ˜¯ä¸€ä¸ªç”¨ Hexo + Ayer ä¸»é¢˜æ­å»ºçš„åšå®¢~",
                    "æ¬¢è¿æ¥åˆ°è¿™ä¸ªåšå®¢ï¼Œè¯·å¤šæŒ‡æ•™ï¼",
                    "å¸Œæœ›ä½ èƒ½åœ¨è¿™é‡Œæ‰¾åˆ°æœ‰è¶£çš„å†…å®¹ï¼",
                    "æœ‰ä»€ä¹ˆæƒ³è¯´çš„å¯ä»¥ç»™æˆ‘ç•™è¨€å“¦ï¼"
                ],
                // ç©ºé—²æ—¶çš„éšæœºå¯¹è¯
                idle: [
                    "ä»Šå¤©å¤©æ°”çœŸä¸é”™å‘¢...",
                    "å¥½æ— èŠå•Šï¼Œé™ªæˆ‘ç©ä¼šå„¿å˜›~",
                    "ä½ è¯´ï¼Œæˆ‘ä¸ºä»€ä¹ˆä¼šåœ¨è¿™é‡Œå‘¢ï¼Ÿ",
                    "å·å·å‘Šè¯‰ä½ ï¼Œåšä¸»æœ€è¿‘åˆåœ¨æŠ˜è…¾æ–°ä¸œè¥¿äº†",
                    "å—¯...æˆ‘åœ¨æƒ³ä»Šæ™šåƒä»€ä¹ˆå¥½å‘¢ï¼Ÿ"
                ]
            }
        },
        tools: {
            enable: true,
            items: ["switch-model", "switch-texture", "photo", "info", "quit"]
        }
    };
    
    // åˆå§‹åŒ–çœ‹æ¿å¨˜
    if (typeof initLive2dWidget !== 'undefined') {
        initLive2dWidget();
        console.log('âœ… çœ‹æ¿å¨˜åˆå§‹åŒ–æˆåŠŸ');
    } else {
        console.error('âŒ initLive2dWidget å‡½æ•°æœªå®šä¹‰');
        // 3ç§’åé‡è¯•
        setTimeout(function() {
            if (typeof initLive2dWidget !== 'undefined') {
                initLive2dWidget();
            }
        }, 3000);
    }
}

// èµ„æºåŠ è½½æ£€æŸ¥
function checkResourcesLoaded() {
    const resources = ['/js/waifu.css', '/js/waifu-tips.js', '/js/live2d.js'];
    let allLoaded = true;
    
    resources.forEach(resource => {
        const elements = document.querySelectorAll(`[href="${resource}"], [src="${resource}"]`);
        if (elements.length === 0) {
            console.warn(`âš ï¸ èµ„æºæœªæ‰¾åˆ°: ${resource}`);
            allLoaded = false;
        }
    });
    
    return allLoaded;
}

// é¡µé¢åŠ è½½å®Œæˆåå»¶è¿ŸåŠ è½½çœ‹æ¿å¨˜
window.addEventListener('load', function() {
    console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡åˆå§‹åŒ–çœ‹æ¿å¨˜');
    
    if (checkResourcesLoaded()) {
        setTimeout(initWidget, 1000);
    } else {
        console.log('â³ èµ„æºæœªå®Œå…¨åŠ è½½ï¼Œ3ç§’åé‡è¯•...');
        setTimeout(initWidget, 3000);
    }
});

// ç§»åŠ¨è®¾å¤‡é€‚é…
function checkMobile() {
    if (screen.width <= 768) {
        console.log('ğŸ“± ç§»åŠ¨è®¾å¤‡æ£€æµ‹');
        // ä¸ºç§»åŠ¨è®¾å¤‡æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
        document.addEventListener('touchstart', function() {
            if (window.live2d_widget) {
                window.live2d_widget.initMobile();
            }
        });
    }
}

// åˆå§‹åŒ–ç§»åŠ¨è®¾å¤‡æ£€æµ‹
checkMobile();

// å¤‡ç”¨åŠ è½½æ–¹æ¡ˆ
setTimeout(function() {
    if (typeof initLive2dWidget === 'undefined') {
        console.log('ğŸ”„ å°è¯•å¤‡ç”¨åŠ è½½æ–¹æ¡ˆ...');
        // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…¶ä»–å¤‡é€‰æ–¹æ¡ˆ
    }
}, 5000);
</script>
<!-- Live2D çœ‹æ¿å¨˜ä»£ç ç»“æŸ -->

<% if (theme.busuanzi && theme.busuanzi.enable){ %>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<% } %>
