<footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        <% if (theme.since && !isNaN(theme.since) && theme.since < date(new Date(), 'YYYY')) { %><%- theme.since%>-<% } %><%= date(new Date(), 'YYYY') %>
        <i class="ri-heart-fill heart_icon"></i> <%= config.author || config.title %>
      </li>
    </ul>
    <ul>
      <li>
        <% if (theme.pageFooter){ %>
        <% var hexoLink = '<a href="https://hexo.io" target="_blank">Hexo</a>'; %>
        <% var themeLink = '<a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>'; %>
        <%- __('powered_by', hexoLink) %>
        <span class="division">|</span>
        <%- __('theme', themeLink) %>
        <% } %>
      </li>
    </ul>
    <ul>
      <li>
        <% if (theme.busuanzi && theme.busuanzi.enable){ %>
        <%# "不蒜子统计" %>
        <%- partial('post/busuanzi') %>
        <% } %>
      </li>
    </ul>
    <ul>
      <% if (theme.icp&&theme.icp.enable){ %>
        <li>
          <a href="<%= theme.icp.url %>" target="_black" rel="nofollow"><%= theme.icp.text %></a>
        </li>
        <% } %>
    </ul>
    <ul>
      <% if (theme.gongan&&theme.gongan.enable){ %>
      <li>
          <img src="<%= theme.gongan.img %>"></img>
          <a href="<%= theme.gongan.url %>" target="_black" rel="nofollow"><%= theme.gongan.text %></a>
      </li>
        <% } %>
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        <% if (theme.cnzz&&theme.cnzz.enable){ %>
        <script type="text/javascript" src='<%= theme.cnzz.url%>'></script>
        <% } %>
      </li>
    </ul>
  </div>
</footer>

<!-- Live2D 看板娘代码开始 -->
<!-- 使用本地路径加载 Live2D 资源 -->
<link rel="stylesheet" href="/js/waifu.css"/>
<script src="/js/waifu-tips.js"></script>
<script src="/js/live2d.js"></script>

<script>
// 初始化看板娘
function initWidget() {
    console.log('🔄 开始初始化看板娘...');
    
    // 配置设置
    window.live2d_settings = {
        model: { 
            scale: 1,
            // 使用本地路径指向 LSS 模型
            jsonPath: '/live2d_models/lss/LSS.model3.json',
        },
        display: {
            position: 'right',
            width: 220,
            height: 400,
            hOffset: 0,
            vOffset: -20,
            superSample: 2,
        },
        mobile: { 
            show: true,        // 在移动设备上显示
            scale: 0.6,        // 移动设备上的缩放比例
            motion: true       // 移动设备上是否启用触摸动作
        },
        react: { 
            opacity: 0.9, 
            opacityDefault: 0.7,
            opacityOnHover: 0.9
        },
        dialog: {
            enable: true,
            script: {
                // 点击身体时的对话
                click: [
                    "嘿！欢迎来到我的小窝！✧(≖ ◡ ≖✿)",
                    "这是一个用 Hexo + Ayer 主题搭建的博客~",
                    "欢迎来到这个博客，请多指教！",
                    "希望你能在这里找到有趣的内容！",
                    "有什么想说的可以给我留言哦！"
                ],
                // 空闲时的随机对话
                idle: [
                    "今天天气真不错呢...",
                    "好无聊啊，陪我玩会儿嘛~",
                    "你说，我为什么会在这里呢？",
                    "偷偷告诉你，博主最近又在折腾新东西了",
                    "嗯...我在想今晚吃什么好呢？"
                ]
            }
        },
        tools: {
            enable: true,
            items: ["switch-model", "switch-texture", "photo", "info", "quit"]
        }
    };
    
    // 初始化看板娘
    if (typeof initLive2dWidget !== 'undefined') {
        initLive2dWidget();
        console.log('✅ 看板娘初始化成功');
    } else {
        console.error('❌ initLive2dWidget 函数未定义');
        // 3秒后重试
        setTimeout(function() {
            if (typeof initLive2dWidget !== 'undefined') {
                initLive2dWidget();
            }
        }, 3000);
    }
}

// 资源加载检查
function checkResourcesLoaded() {
    const resources = ['/js/waifu.css', '/js/waifu-tips.js', '/js/live2d.js'];
    let allLoaded = true;
    
    resources.forEach(resource => {
        const elements = document.querySelectorAll(`[href="${resource}"], [src="${resource}"]`);
        if (elements.length === 0) {
            console.warn(`⚠️ 资源未找到: ${resource}`);
            allLoaded = false;
        }
    });
    
    return allLoaded;
}

// 页面加载完成后延迟加载看板娘
window.addEventListener('load', function() {
    console.log('📄 页面加载完成，准备初始化看板娘');
    
    if (checkResourcesLoaded()) {
        setTimeout(initWidget, 1000);
    } else {
        console.log('⏳ 资源未完全加载，3秒后重试...');
        setTimeout(initWidget, 3000);
    }
});

// 移动设备适配
function checkMobile() {
    if (screen.width <= 768) {
        console.log('📱 移动设备检测');
        // 为移动设备添加触摸事件支持
        document.addEventListener('touchstart', function() {
            if (window.live2d_widget) {
                window.live2d_widget.initMobile();
            }
        });
    }
}

// 初始化移动设备检测
checkMobile();

// 备用加载方案
setTimeout(function() {
    if (typeof initLive2dWidget === 'undefined') {
        console.log('🔄 尝试备用加载方案...');
        // 可以在这里添加其他备选方案
    }
}, 5000);
</script>
<!-- Live2D 看板娘代码结束 -->

<% if (theme.busuanzi && theme.busuanzi.enable){ %>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<% } %>
